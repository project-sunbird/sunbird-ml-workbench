experiment_name: Example3_MovieLens_Recommendation
owner: sanjay
experiment_dir: MLWBdemo_3/experiment/
inputs:
  link_to_raw_data: http://files.grouplens.org/datasets/movielens/ml-100k.zip
  prediction_set: inputs/tutorial3_testset.csv
outputs:
  gridsearch_report_file: outputs/model_report_file
  topK_predictions_rmse_file: outputs/topK_predictions_rmse_file

graph:
  - node_name: data_fetch
    inputs: link_to_raw_data
    outputs: raw_data
    operation: movielens_data_fetcher
    arguments:
      separator: '\t'

  - node_name: read_prediction_set
    inputs: prediction_set
    outputs: prediction_data
    operation: csv_reader
    arguments:

  - node_name: data_split
    inputs: raw_data
    outputs: [training_data, validation_data]
    operation: df_splitter_on_column_values
    arguments:
      split_column: timestamp
      training_percentage: 0.8
      ascending: True

  - node_name: training
    inputs: training_data
    outputs: [model_best_rmse, gridsearch_report]
    operation: KNNBasic_model_trainer
    arguments:
      algo_class: KNNBasic
      best_model_selection_metric: rmse
      param_grid: 
        k: [5,10]
        sim_options:
          'name': ['cosine']
          'min_support': [1]
          'user_based': [False]
      cv: 2
      measures: ['rmse','mae']

  - node_name: prediction_using_rmse
    inputs: [model_best_rmse,prediction_data]
    outputs: topK_predictions_rmse
    operation: model_predictor
    arguments:
      topK: 10

  - node_name: evaluation_rmse
    inputs: [model_best_rmse, validation_data]
    outputs: evalaution_report_rmse
    operation: model_evaluation
    arguments:

  - node_name: write_outputs
    inputs:
      - gridsearch_report
      - topK_predictions_rmse
    outputs: 
      - gridsearch_report_file
      - topK_predictions_rmse_file
    operation: csv_writer
    arguments:
      index: False