experiment_name: content_reuse_mapping
owner: sunbird

inputs:
  path_to_siamese_config: inputs/siamese_configuration.json
  path_to_result_folder: !ENV ${CONTENT_REUSE_HOME}/state_dtb
  path_to_trained_model: ! ENV ${MODEL_REPO_HOME}/lstm_50_50_0_17_0_25.h5
  path_to_pickled_tokenizer: ! ENV ${MODEL_REPO_HOME}/tokenizer.pkl

outputs:
  dummy: /home/DS_HOME

graph:

  - node_name: data_preparation
    inputs: [path_to_result_folder]
    outputs: [path_to_cosine_similarity_matrix, path_to_complete_data_set]
    operation: contentreuse.scoring_data_preparation
    arguments:
      sentence_length: 4
      cosine_score_threshold: 0.51

  - node_name: bert_scoring
    inputs: [path_to_result_folder, path_to_trained_model, path_to_pickled_tokenizer, data_preparation.path_to_complete_data_set, path_to_siamese_config]
    outputs: [path_to_predicted_output]
    operation: contentreuse.bert_scoring
    arguments:
      filterby_typeofmatch: nan
      filterby_grade_range: nan
      threshold: 0.482528924942016
      embedding_method: BERT

  - node_name: topic_aggregation
    inputs: [bert_scoring.path_to_predicted_output]
    outputs: [path_to_output_topic_agg]
    operation: contentreuse.topic_level_aggregation
    arguments:
      aggregation_criteria: average
      compute_topic_similarity: True
      mandatory_column_names:
        stb_topic_col_name: stb_id
        ref_topic_col_name: ref_id
        pred_agg_col_name: pred_label_percentage
        label_col_name: actual_label
        tp_col_name: TP_count
        fp_col_name: FP_count
        tn_col_name: TN_count
        fn_col_name: FN_count

  - node_name: evaluation
    inputs: [topic_aggregation.path_to_output_topic_agg]
    outputs: [path_to_k_eval_metrics]
    operation: contentreuse.content_reuse_evaluation
    arguments:
      window: 5
